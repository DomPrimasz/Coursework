<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/home.css">
    <title>Home</title>

    <script>

        function pageLoad() {
            console.log("invoked pageload");

            //get the quizes and then display on page

            const url = "/quiz/list/";	// API method on webserver will be in Weight class with @Path of list

            fetch(url, {
                method: "GET",
            }).then(response => {
                return response.json();                 //return response to JSON
            }).then(response => {
                if (response.hasOwnProperty("Error")) { //checks if response from server has a key "Error"
                    alert(JSON.stringify(response));    // if it does, convert JSON object to string and alert
                } else {
                    formatQuizList(response);
                }
            });


        }

        function formatQuizList(response){
            console.log("invoked formatQuizList");
            console.log(response);

            //use code from week 1 to write a for loop that builds on the HTML for a table with each row being data from one of the
            //JSON objects in the JSON array of response
            let dataHTML = "";


            dataHTML = "";
            for (let item of response) {                             //creates a table with rows for every item in JSON array
                dataHTML += "<tr class='QuizContainer'><td class='QuizTitle'>" + item.Title + "</td><td class='QuizDescription'>" + item.Description +
                    "</td><td> <button onclick='click' class='alertQuizName'  " +
                    "data-QuizID='" + item.Title + "'>Start Quiz</button></td></tr>";
            }
            document.getElementById("QuizTable").innerHTML += dataHTML;


            document.addEventListener("click", function (event) {
                if (event.target.matches('.alertQuizName')) {                      //alertItemName is the class we gave all the button elements
                    var QuizName = event.target.getAttribute("data-QuizID");        //data-itemID is an attribute we gave the button
                    alert("You clicked on " + QuizName);
                    sessionStorage.setItem("QuizName", QuizName);
                    window.open("Quiz.html", "_self");
                }
            });


        }


    </script>
</head>
<body onload="pageLoad()">
Welcome to Quiz World!!
<br>
<div class="Toolbar">
    <button id="ProfileButton" type="button" onclick=window.open("profile.html","_self")>Profile</button>
    <button id="CustomQuizButton" type="button">Custom Quizzes</button>
    <button id="LogOutButton" type="button" onclick='window.open("Login.html", "_self")'>Logout</button>

</div>
<br><br>
Choose a Quiz:
<table id="QuizTable"></table>

</body>
</html>